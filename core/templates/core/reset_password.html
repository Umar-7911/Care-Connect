{% extends 'core/base.html' %}
{% load static %}

{% block title %}Reset Password - CareConnect{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="logo-section">
        <div class="logo">
            <div class="logo-icon">+</div>
            CareConnect
        </div>
        <p class="subtitle">Healthcare Emergency Coordination</p>
    </div>

    {% if otp_verified %}
    <h1 class="page-title">Reset Your Password</h1>
    <p class="page-description">Enter your new password below</p>
    {% else %}
    <h1 class="page-title">Verify OTP</h1>
    <p class="page-description">Enter the OTP sent to {{ email }}</p>
    {% endif %}

    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}

    {% if otp_verified %}
    <!-- Password Reset Form -->
    <form method="post" action="{% url 'core:reset_password' %}" id="resetPasswordForm">
        {% csrf_token %}

        <div class="form-group">
            <label for="password">New Password <span class="required">*</span></label>
            <div class="input-wrapper">
                <span class="input-icon">ğŸ”’</span>
                <input type="password" id="password" name="password" placeholder="Enter new password (min 8 characters)" required autofocus>
                <span class="password-toggle" onclick="togglePassword('password', this)">ğŸ‘ï¸</span>
            </div>
        </div>

        <div class="form-group">
            <label for="confirm_password">Confirm New Password <span class="required">*</span></label>
            <div class="input-wrapper">
                <span class="input-icon">ğŸ”’</span>
                <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm your new password" required>
                <span class="password-toggle" onclick="togglePassword('confirm_password', this)">ğŸ‘ï¸</span>
            </div>
        </div>

        <button type="submit" class="primary-btn">Reset Password</button>
    </form>
    {% else %}
    <!-- OTP Verification Form -->
    <form method="post" id="verifyOtpForm">
        {% csrf_token %}

        <div class="form-group">
            <label for="otp">OTP Code <span class="required">*</span></label>
            <div class="input-wrapper">
                <span class="input-icon">ğŸ”</span>
                <input type="text" id="otp" name="otp" placeholder="Enter 6-digit OTP" 
                    maxlength="6" pattern="[0-9]{6}" required autofocus>
            </div>
            <small style="color: #666; font-size: 13px; margin-top: 4px; display: block;">
                Check your email for the 6-digit OTP code
            </small>
        </div>

        <button type="submit" class="primary-btn">Verify OTP</button>
    </form>
    {% endif %}

    <div class="secondary-link">
        {% if otp_verified %}
        <a href="{% url 'core:login' %}">Back to Sign In</a>
        {% else %}
        Didn't receive OTP? <a href="{% url 'core:forgot_password' %}">Request New OTP</a>
        {% endif %}
    </div>
</div>

<script>
    function togglePassword(inputId, icon) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            icon.textContent = 'ğŸ™ˆ';
        } else {
            input.type = 'password';
            icon.textContent = 'ğŸ‘ï¸';
        }
    }

    // Auto-focus on OTP input and format to numbers only
    {% if not otp_verified %}
    document.addEventListener('DOMContentLoaded', function() {
        const otpInput = document.getElementById('otp');
        if (otpInput) {
            otpInput.addEventListener('input', function(e) {
                // Only allow numbers
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
        }
    });
    {% endif %}
</script>
{% endblock %}
